<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
	<title></title>
	<link href="css/mui.min.css" rel="stylesheet"/>
	<style>body{background-color: white;}</style>
	<script src="js/mui.min.js"></script>
	<script src="js/echarts.min.js"></script>
	<script type="text/javascript" charset="utf-8">mui.init();</script>
</head>
<body>
	<div id="main" style="width: 100%;height: 400px;"></div>
	<div id="main1" style="width: 100%;height: 400px;"></div>
	<p id="txt" style="margin-left: 20%;color: #d4434c;"></p>
	<script>
		var myChart = echarts.init(document.getElementById('main'));
		var myChart1 = echarts.init(document.getElementById('main1'));
		mui.ajax('api.php', {
		// mui.ajax('http://120.55.166.112:8080/gold/hq.go', {
			data: {
				request_url: 'http://120.55.166.112:8080/gold/hq.go?pid=1001&sid=10005&type=1&sdate=20160601',
			},
			// data:{
			// 	pid:'1001',
			// 	sid:'10005',
			// 	type:'1',
			// 	sdate:'20160601'
			// },
			dataType: 'json',
			type: 'post',
			timeout: 10000,
			success: function(data) {
				var kArray = [],
					volArray = [],
					aArray = [],
					mArray = [];
				for (var i = 0; i < data.Resp.data.row.length; i++) {
					var a = Number(data.Resp.data.row[i].a),
						vol = Number(data.Resp.data.row[i].vol) / 1000 / 2,
						c = Number(data.Resp.data.row[i].c),
						h = Number(data.Resp.data.row[i].h),
						l = Number(data.Resp.data.row[i].l),
						m = Number(data.Resp.data.row[i].m) / 100000000,
						temp = data.Resp.data.row[i].tday.split(''),
						tday = '';
					o = Number(data.Resp.data.row[i].o);
					for (var j = 0; j < temp.length; j++) {
						if (j == 3 || j == 5) {
							tday += temp[j] + '/';
						} else {
							tday += temp[j];
						}
					}
					kArray[i] = [tday, o, c, l, h];
					volArray.push(vol);
					aArray.push(a);
					mArray.push(m);
				}

				console.log(kArray);
				console.log(aArray);
				console.log(volArray);
				console.log(mArray);

				var kData = splitData(kArray);
				option = {
					title: {
						text: '上证指数',
						left: '50%',
						textAlign: 'center',
						padding: [20, 0, 10, 0]
					},
					tooltip: {
						trigger: 'axis',
						axisPointer: {
							type: 'line'
						},
						// formatter: function(params) {
						// 	console.log(params);
						// }
					},
					grid: {
						left: '10%',
						right: '10%',
						bottom: '15%'
					},
					xAxis: {
						type: 'category',
						data: kData.categoryData,
						scale: true,
						boundaryGap: false,
						axisLine: {
							onZero: false
						},
						splitLine: {
							show: false
						},
						splitNumber: 20,
						min: 'dataMin',
						max: 'dataMax'
					},
					yAxis: [
					{
						scale: true,
						show: false
					},
					{
						scale: true,
						show: false
					},
					{
						scale: true,
						show: false
					}
					],
					series: [{
						name: '日K',
						type: 'candlestick',
						data: kData.values,
						itemStyle: {
							normal: {
								color: '#e52e4c',
								color0: '#5cb660'
							}
						}
					},
					{
						name: 'MA0',
						type: 'line',
						// yAxisIndex: 1,
						data: aArray,
						smooth: true,
						itemStyle: {
							normal: {
								color: '#ff6600'
							}
						}
					},
					{
						name: 'MA10',
						type: 'bar',
						yAxisIndex: 1,
						data: volArray,
						smooth: true,
						itemStyle: {
							normal: {
								color: new echarts.graphic.LinearGradient(
									0, 0, 0, 1,
									[
										{offset: 0, color: '#83bff6'},
										{offset: 0.5, color: '#188df0'},
										{offset: 1, color: '#188df0'}
									]
								)
							}
						}
					},
					{
						name: 'MA20',
						type: 'line',
						yAxisIndex: 2,
						data: mArray,
						smooth: true,
						itemStyle: {
							normal: {
								color: '#2e3192'
							}
						}
					}
					]
				};
				myChart.setOption(option);
				myChart1.setOption(option);

				// myChart.connect(myChart1);
				// myChart1.connect(myChart);
				// echarts.connect([myChart,myChart1])

				window.onresize = function() {
					myChart.resize();

					myChart1.resize();
				}
			},
			error: function(xhr, type, errorThrown) {
				console.log(type);
			}
		});
		function splitData(rawData) {
			var categoryData = [];
			var values = [];
			for (var i = 0; i < rawData.length; i++) {
				categoryData.push(rawData[i].splice(0, 1)[0]);
				values.push(rawData[i]);
			}
			return {
				categoryData: categoryData,
				values: values
			};
		}
	</script>
</body>
</html>